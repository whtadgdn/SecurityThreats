---
title: "–û—Å–Ω–æ–≤—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é R –∏ Dplyr"
subtitle: "–û—Ç—á–µ—Ç –ø–æ –ø—Ä–∞–∫—Ç–∏–∫–µ 2"
author: "Zid4a84@yandex.ru"
format: 
  md:
    output-file: README.md
---

## –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

1. –†–∞–∑–≤–∏—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è R –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
2. –ó–∞–∫—Ä–µ–ø–∏—Ç—å –∑–Ω–∞–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–∞ R
3. –†–∞–∑–≤–∏—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–∞ dplyr ‚Äì —Ñ—É–Ω–∫—Ü–∏–∏ select(), filter(), mutate(), arrange(), group_by()


---

## –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

1. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ: **OC Windows 11 Pro**  
2. –°—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: **RStudio**  
3. –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä —è–∑—ã–∫–∞: **R 4.5.1**  
4. –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø–∞–∫–µ—Ç: **dplyr**

---

## –ü–ª–∞–Ω

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç `dplyr`.  
2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ –ø–∞–∫–µ—Ç `dplyr` –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö `starwars` —Å –ø–æ–º–æ—â—å—é —è–∑—ã–∫–∞ **R** –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:

   1. –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –≤ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–µ?  
   2. –°–∫–æ–ª—å–∫–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –≤ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–µ?  
   3. –ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–∏–¥ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞?  
   4. –°–∫–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ä–∞—Å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (`species`) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –¥–∞–Ω–Ω—ã—Ö?  
   5. –ù–∞–π—Ç–∏ —Å–∞–º–æ–≥–æ –≤—ã—Å–æ–∫–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.  
   6. –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –Ω–∏–∂–µ 170 —Å–º.  
   7. –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∏–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ (–ò–ú–¢) –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π.  
      –§–æ—Ä–º—É–ª–∞:  
      $$I = \frac{m}{h^2}$$  
      –≥–¥–µ *m* ‚Äî –º–∞—Å—Å–∞ (mass), *h* ‚Äî —Ä–æ—Å—Ç (height).  
   8. –ù–∞–π—Ç–∏ 10 —Å–∞–º—ã—Ö ‚Äú–≤—ã—Ç—è–Ω—É—Ç—ã—Ö‚Äù –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (–æ—Ç–Ω–æ—à–µ–Ω–∏–µ `mass/height`).  
   9. –ù–∞–π—Ç–∏ —Å—Ä–µ–¥–Ω–∏–π –≤–æ–∑—Ä–∞—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∫–∞–∂–¥–æ–π —Ä–∞—Å—ã (`species`).  
   10. –ù–∞–π—Ç–∏ —Å–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç –≥–ª–∞–∑ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π.  
   11. –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Å—Ä–µ–¥–Ω—é—é –¥–ª–∏–Ω—É –∏–º–µ–Ω–∏ –≤ –∫–∞–∂–¥–æ–π —Ä–∞—Å–µ.

---

## –®–∞–≥–∏

---
### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞ dplyr, –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞.
```{r}
install.packages("dplyr")
WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding:

https://cran.rstudio.com/bin/windows/Rtools/
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø–∞–∫–µ—Ç –≤ ‚ÄòC:/Users/Zid4a/AppData/Local/R/win-library/4.5‚Äô
(–ø–æ—Ç–æ–º—É —á—Ç–æ ‚Äòlib‚Äô –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ)
–ø—Ä–æ–±—É—é URL 'https://cran.rstudio.com/bin/windows/contrib/4.5/dplyr_1.1.4.zip'
Content type 'application/zip' length 1593566 bytes (1.5 MB)
downloaded 1.5 MB

–ø–∞–∫–µ—Ç ‚Äòdplyr‚Äô —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω, MD5-—Å—É–º–º—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã

–°–∫–∞—á–∞–Ω–Ω—ã–µ –±–∏–Ω–∞—Ä–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤
	C:\Users\Zid4a\AppData\Local\Temp\RtmpKaM0Jo\downloaded_packages
```
```{r}
 library(dplyr)
```
```{r}
–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è—é –ø–∞–∫–µ—Ç: ‚Äòdplyr‚Äô

–°–ª–µ–¥—É—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã —Å–∫—Ä—ã—Ç—ã –æ—Ç ‚Äòpackage:stats‚Äô:

    filter, lag

–°–ª–µ–¥—É—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã —Å–∫—Ä—ã—Ç—ã –æ—Ç ‚Äòpackage:base‚Äô:

    intersect, setdiff, setequal, union
starwars
# A tibble: 87 √ó 14
   name     height  mass hair_color skin_color eye_color birth_year sex   gender homeworld species films
   <chr>     <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr>  <chr>     <chr>   <lis>
 1 Luke Sk‚Ä¶    172    77 blond      fair       blue            19   male  mascu‚Ä¶ Tatooine  Human   <chr>
 2 C-3PO       167    75 NA         gold       yellow         112   none  mascu‚Ä¶ Tatooine  Droid   <chr>
 3 R2-D2        96    32 NA         white, bl‚Ä¶ red             33   none  mascu‚Ä¶ Naboo     Droid   <chr>
 4 Darth V‚Ä¶    202   136 none       white      yellow          41.9 male  mascu‚Ä¶ Tatooine  Human   <chr>
 5 Leia Or‚Ä¶    150    49 brown      light      brown           19   fema‚Ä¶ femin‚Ä¶ Alderaan  Human   <chr>
 6 Owen La‚Ä¶    178   120 brown, gr‚Ä¶ light      blue            52   male  mascu‚Ä¶ Tatooine  Human   <chr>
 7 Beru Wh‚Ä¶    165    75 brown      light      blue            47   fema‚Ä¶ femin‚Ä¶ Tatooine  Human   <chr>
 8 R5-D4        97    32 NA         white, red red             NA   none  mascu‚Ä¶ Tatooine  Droid   <chr>
 9 Biggs D‚Ä¶    183    84 black      light      brown           24   male  mascu‚Ä¶ Tatooine  Human   <chr>
10 Obi-Wan‚Ä¶    182    77 auburn, w‚Ä¶ fair       blue-gray       57   male  mascu‚Ä¶ Stewjon   Human   <chr>
# ‚Ñπ 77 more rows
# ‚Ñπ 2 more variables: vehicles <list>, starships <list>
# ‚Ñπ Use `print(n = ...)` to see more rows
```

### –ê–Ω–∞–ª–∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

#### –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –≤ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–µ?

```{r}
nrow(starwars)
```
[1] 87

#### –°–∫–æ–ª—å–∫–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –≤ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–µ?
```{r}
starwars %>% ncol()
```
[1] 14

#### –ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–∏–¥ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞?
```{r}
starwars %>% glimpse()
```
Rows: 87
Columns: 14
$ name       <chr> "Luke Skywalker", "C-3PO", "R2-D2", "Darth Vader", "Leia Organa", "Owen Lars", "Beru Wh‚Ä¶
$ height     <int> 172, 167, 96, 202, 150, 178, 165, 97, 183, 182, 188, 180, 228, 180, 173, 175, 170, 180,‚Ä¶
$ mass       <dbl> 77.0, 75.0, 32.0, 136.0, 49.0, 120.0, 75.0, 32.0, 84.0, 77.0, 84.0, NA, 112.0, 80.0, 74‚Ä¶
$ hair_color <chr> "blond", NA, NA, "none", "brown", "brown, grey", "brown", NA, "black", "auburn, white",‚Ä¶
$ skin_color <chr> "fair", "gold", "white, blue", "white", "light", "light", "light", "white, red", "light‚Ä¶
$ eye_color  <chr> "blue", "yellow", "red", "yellow", "brown", "blue", "blue", "red", "brown", "blue-gray"‚Ä¶
$ birth_year <dbl> 19.0, 112.0, 33.0, 41.9, 19.0, 52.0, 47.0, NA, 24.0, 57.0, 41.9, 64.0, 200.0, 29.0, 44.‚Ä¶
$ sex        <chr> "male", "none", "none", "male", "female", "male", "female", "none", "male", "male", "ma‚Ä¶
$ gender     <chr> "masculine", "masculine", "masculine", "masculine", "feminine", "masculine", "feminine"‚Ä¶
$ homeworld  <chr> "Tatooine", "Tatooine", "Naboo", "Tatooine", "Alderaan", "Tatooine", "Tatooine", "Tatoo‚Ä¶
$ species    <chr> "Human", "Droid", "Droid", "Human", "Human", "Human", "Human", "Droid", "Human", "Human‚Ä¶
$ films      <list> <"A New Hope", "The Empire Strikes Back", "Return of the Jedi", "Revenge of the Sith",‚Ä¶
$ vehicles   <list> <"Snowspeeder", "Imperial Speeder Bike">, <>, <>, <>, "Imperial Speeder Bike", <>, <>,‚Ä¶
$ starships  <list> <"X-wing", "Imperial shuttle">, <>, <>, "TIE Advanced x1", <>, <>, <>, <>, "X-wing", <‚Ä¶

### –°–∫–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ä–∞—Å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (species) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –¥–∞–Ω–Ω—ã—Ö?
```{r}
starwars$species %>% unique() %>% length()
```
[1] 38

#### –ù–∞–π—Ç–∏ —Å–∞–º–æ–≥–æ –≤—ã—Å–æ–∫–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.

```{r}
starwars %>% arrange(desc(height)) %>% head(1) %>% select(name)
```
 A tibble: 1 √ó 1
  name       
  <chr>      
1 Yarael Poof

### –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –Ω–∏–∂–µ 170

```{r}
starwars %>% filter(!is.na(height) & height < 170) %>% select(name,height) %>% knitr::kable()
```
name	height
C-3PO	167
R2-D2	96
Leia Organa	150
Beru Whitesun Lars	165
R5-D4	97
Yoda	66
Mon Mothma	150
Wicket Systri Warrick	88
Nien Nunb	160
Watto	137
Sebulba	112
Shmi Skywalker	163
Ratts Tyerel	79
Dud Bolt	94
Gasgano	122
Ben Quadinaros	163
Cord√©	157
Barriss Offee	166
Dorm√©	165
Zam Wesell	168
Jocasta Nu	167
R4-P17	96

#### –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –ò–ú–¢ (–∏–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞) –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π. –ò–ú–¢ –ø–æ–¥—Å—á–∏—Ç–∞—Ç—å –ø–æ —Ñ–æ—Ä–º—É–ªe$I=\frac{m}{h^2}$, –≥–¥–µ ùëö ‚Äì –º–∞—Å—Å–∞ (weight), –∞ ‚Ñé ‚Äì —Ä–æ—Å—Ç (height).

```{r}
starwars %>%
  mutate(height_m = height / 100,bmi = mass / (height_m)^2) %>%
  select(name, mass, height, bmi)
```
 A tibble: 87 √ó 4
   name                mass height   bmi
   <chr>              <dbl>  <int> <dbl>
 1 Luke Skywalker        77    172  26.0
 2 C-3PO                 75    167  26.9
 3 R2-D2                 32     96  34.7
 4 Darth Vader          136    202  33.3
 5 Leia Organa           49    150  21.8
 6 Owen Lars            120    178  37.9
 7 Beru Whitesun Lars    75    165  27.5
 8 R5-D4                 32     97  34.0
 9 Biggs Darklighter     84    183  25.1
10 Obi-Wan Kenobi        77    182  23.2
 ‚Ñπ 77 more rows

#### –ù–∞–π—Ç–∏ 10 —Å–∞–º—ã—Ö ‚Äú–≤—ã—Ç—è–Ω—É—Ç—ã—Ö‚Äù –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π. ‚Äú–í—ã—Ç—è–Ω—É—Ç–æ—Å—Ç—å‚Äù –æ—Ü–µ–Ω–∏—Ç—å –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –º–∞—Å—Å—ã (mass) –∫ —Ä–æ—Å—Ç—É (height) –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π.

```{r}
starwars %>% mutate(Stretching = mass/height)  %>% arrange(desc(Stretching)) %>% head(10) %>% select(name,Stretching) 
```
 A tibble: 10 √ó 2
   name                  Stretching
   <chr>                      <dbl>
 1 Jabba Desilijic Tiure      7.76 
 2 Grievous                   0.736
 3 IG-88                      0.7  
 4 Owen Lars                  0.674
 5 Darth Vader                0.673
 6 Jek Tono Porkins           0.611
 7 Bossk                      0.595
 8 Tarfful                    0.581
 9 Dexter Jettster            0.515
10 Chewbacca                  0.491

#### –ù–∞–π—Ç–∏ —Å—Ä–µ–¥–Ω–∏–π –≤–æ–∑—Ä–∞—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∫–∞–∂–¥–æ–π —Ä–∞—Å—ã –≤—Å–µ–ª–µ–Ω–Ω–æ–π –ó–≤–µ–∑–¥–Ω—ã—Ö –≤–æ–π–Ω.

```{r}
starwars %>%
 mutate(current_year = 100,age = current_year + birth_year) %>%
 filter(!is.na(age) & !is.na(species)) %>%
 group_by(species) %>%
 summarise(average_age = mean(age),count = n()) %>%
 arrange(desc(average_age))
```
 A tibble: 15 √ó 3
   species        average_age count
   <chr>                <dbl> <int>
 1 Yoda's species        996      1
 2 Hutt                  700      1
 3 Wookiee               300      1
 4 Cerean                192      1
 5 Zabrak                154      1
 6 Human                 154.    26
 7 Droid                 153.     3
 8 Trandoshan            153      1
 9 Gungan                152      1
10 Mirialan              149      2
11 Twi'lek               148      1
12 Rodian                144      1
13 Mon Calamari          141      1
14 Kel Dor               122      1
15 Ewok                  108      1

#### –ù–∞–π—Ç–∏ —Å–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç –≥–ª–∞–∑ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –≤—Å–µ–ª–µ–Ω–Ω–æ–π –ó–≤–µ–∑–¥–Ω—ã—Ö –≤–æ–π–Ω.

```{r}
starwars %>% filter(!is.na(eye_color)) %>% group_by(eye_color) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% knitr::kable()
```
  eye_color	count
  brown	21

#### –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Å—Ä–µ–¥–Ω—é—é –¥–ª–∏–Ω—É –∏–º–µ–Ω–∏ –≤ –∫–∞–∂–¥–æ–π —Ä–∞—Å–µ –≤—Å–µ–ª–µ–Ω–Ω–æ–π –ó–≤–µ–∑–¥–Ω—ã—Ö –≤–æ–π–Ω.

```{r}
starwars %>%
  mutate(name_length = nchar(name)) %>%
  filter(!is.na(species)) %>%
  group_by(species) %>%
  summarise(avg_name_length = mean(name_length, na.rm = TRUE),count = n()) %>%
  arrange(desc(avg_name_length))
```
 A tibble: 37 √ó 3
   species   avg_name_length count
   <chr>               <dbl> <int>
 1 Ewok                 21       1
 2 Hutt                 21       1
 3 Geonosian            17       1
 4 Besalisk             15       1
 5 Mirialan             14       2
 6 Toong                14       1
 7 Aleena               12       1
 8 Cerean               12       1
 9 Gungan               11.7     3
10 Human                11.3    35
 ‚Ñπ 27 more rows
 
